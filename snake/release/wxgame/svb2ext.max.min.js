!function(t,i,e){var n=(e.un,e.uns,e.static),s=e.class,a=e.getset,o=(e.__newvec,laya.display.Animation),r=laya.ui.Box,l=laya.utils.Browser,h=laya.ui.Clip,c=laya.filters.ColorFilter,u=laya.ui.Component,p=laya.ui.Dialog,d=(laya.events.Event,laya.utils.Handler),f=laya.ui.Image,m=(laya.net.Loader,laya.maths.Point),g=laya.utils.Pool,y=laya.net.ResourceVersion,b=laya.media.SoundManager,_=(laya.display.Sprite,laya.display.Stage,laya.utils.Tween),v=laya.ui.View,B=laya.webgl.WebGL;e.interface("com.bdoggame.interfaces.IText"),e.interface("com.bdoggame.interfaces.IScene");var S=function(){function t(t,i){this.y=0,this.x=0,this.y=i,this.x=t}return s(t,"com.bdoggame.Coordinates"),t}(),k=function(){function t(){}return s(t,"com.bdoggame.Global"),t.STAGE_WIDTH=750,t.STAGE_HEIGHT=1334,t.param=null,t}(),w=function(){function t(){}return s(t,"com.utils.CommonUtils"),t.getObjWithField=function(t,i,e){if(!t)return null;var n;for(var s in t)if(n=t[s],n[i]==e)return n;return null},t.putProp=function(t,i){for(var e in i)t[e]=i[e];return t},t.formatWord=function(t){return t?(t=t.replace(/[\u0000-\u001f]/gi,""),t=t.replace(/[\u007F-\u00a0]/gi,"")):""},t.removeAllChild=function(t){for(;t.numChildren;)t.removeChildAt(0)},t.sortArray=function(t,i,e){return void 0===e&&(e=!0),com.utils.CommonUtils.descending=e,com.utils.CommonUtils.field=i,t.sort(com.utils.CommonUtils.sortArrayTemp),t},t.sortArrayTemp=function(i,e){return i[com.utils.CommonUtils.field]>e[com.utils.CommonUtils.field]?t.descending?-1:1:i[com.utils.CommonUtils.field]<e[com.utils.CommonUtils.field]?t.descending?1:-1:0},t.sortArray2=function(t,i,e){for(var n=t.length,s=0;n-1>s;s++)for(var a=0;n-s-1>a;a++)if(e.apply(i,[t[a],t[a+1]])<0){var o=t[a+1];t[a+1]=t[a],t[a]=o}return t},t.sortArray3=function(t,i){return void 0===i&&(i=!0),com.utils.CommonUtils.descending=i,t.sort(com.utils.CommonUtils.sortArrayTemp3),t},t.sortArrayTemp3=function(i,e){return i>e?t.descending?-1:1:e>i?t.descending?1:-1:0},t.findFromArray=function(t,i,e){for(var n=0;n<t.length;n++)if(t[n][i]==e)return t[n];return null},t.findListFromArray=function(t,i,e){for(var n=[],s=0;s<t.length;s++)t[s][i]==e&&n.push(t[s]);return n},t.pushListToList=function(i,e,n){void 0===n&&(n=!1);var s;for(var a in e)s=e[a],t.pushToList(i,s,n)},t.pushToList=function(t,i,e){return void 0===e&&(e=!1),t?-1!=t.indexOf(i)?!1:(e?t.unshift(i):t.push(i),!0):!1},t.spleceToList=function(t,i){if(!t)return!1;var e=0;return e=t.indexOf(i),-1==e?!1:(t.splice(e,1),!0)},t.copyArray=function(t){for(var i=[],e=0;e<t.length;e++)i[e]=t[e];return i},t.fillArray=function(t,i,n){for(;t.length<i;)e.__isClass(n)?t.push(new n):t.push(n)},t.randomArray=function(t){for(var i=t.slice(),e=i.length,n=[];e;)n.push(i.splice(parseInt(Math.random()*e--),1)[0]);return n},t.randomRange=function(t,i){return Math.random()*(i-t)+t},t.rangeInt=function(t,i){return Math.floor(Math.random()*(i-t)+t)},t.round=function(t,i){var e=Math.pow(10,i),n=int(t*e),s=int(t),a=t-s;return 1==Math.round(a)&&(n+=1),n/e},t.getRandomNumArray=function(t,i){for(var e=0,n=t.concat(),s=[],a=0;i>a&&0!=n.length;a++)e=Math.floor(n.length*Math.random()),s.push(n.splice(e,1)[0]);return s},t.traceArrayBuffer=function(t){for(var i="",e=new Int8Array(t),n=0;n<e.byteLength;n++)i+=e[n].toString(16)+" ";return console.log(i),i},t.clearHandler=function(t){},t.openUrl=function(t,i,e){void 0===i&&(i="_blank"),void 0===e&&(e=""),l.window.open(t,i)},t.arrayRomdonValue=function(t){return t?t[Math.floor(Math.random()*(t.length-1))]:null},t.field=null,t.descending=!1,t}(),x=function(){function t(){}return s(t,"com.utils.JSUtils"),t.createJSScript=function(t,i,e,n){var s=l.document,a=s.getElementById(t);null==a?(a=s.createElement("Script"),a.type="text/javascript",a.src=i,a.id=t,s.head.appendChild(a)):a.src=i,a.onload=function(){n.apply(e),a.onload=null,a.onerror=null},a.onerror=function(){alert("加载JS失败"),a.onload=null,a.onerror=null}},t.dataToParam=function(t){var i="";for(var e in t)i+=e+"="+t[e]+"&";return i.substring(0,i.length-1)},t.isFromWeiXin=function(){var t=l.window.navigator.userAgent.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)?!0:!1},t.getRequestParameter=function(){var t=i.location.search||i.location.hash;if(t){for(var e=t.substring(1).split("&"),n={},s=0;s<e.length;s++)n[e[s].split("=")[0]]=e[s].split("=")[1];return n}return{}},t}(),L=function(){function t(){}return s(t,"com.utils.MathUtils"),t.SD=function(i,e,n,s,a,o){void 0===o&&(o=Number.MAX_VALUE),s=Math.max(1e-4,s);var r=2/s,l=r*a,h=1/(1+l+.48*l*l+.235*l*l*l),c=i-e,u=e,p=o*s;c=t.Clamp(c,-p,p),e=i-c;var d=(n+r*c)*a;n=(n-r*d)*h;var f=e+(c+d)*h;return u-i>0==f>u&&(f=u,n=(f-u)/a),[f,n]},t.Lerp=function(i,e,n){return i+(e-i)*t.Clamp01(n)},t.Clamp01=function(t){return 0>t?0:t>1?1:t},t.MoveTowards=function(i,e,n){return Math.abs(e-i)<=n?e:i+t.Sign(e-i)*n},t.MoveTowardsPoint=function(i,e,n){var s=t.PointSub(e,i),a=t.PointmMagnitude(s);return a>n&&0!=a?(s.x/=a,s.y/=a,s.x*=n,s.y*=n,s.x+=i.x,s.y+=i.y,s):(s.x=e.x,s.y=e.y,s)},t.PointSub=function(t,i){return new m(t.x-i.x,t.y-i.y)},t.PointmMagnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.Sign=function(t){return 0>t?-1:1},t.Clamp=function(t,i,e){return i>t?i:t>e?e:t},t}(),C=function(){function t(){e.init(750,1334,B),e.stage.bgColor="#25112a",e.stage.frameRate="fast",l.onMobile&&(e.stage.screenMode="vertical"),e.stage.scaleMode="fixedwidth",e.stage.addChild(M.instance),M.instance.sceneLayer.addChild(V.instance),e.stage.on("resize",this,this.onResize),k.param=x.getRequestParameter(),l.window.conch&&l.window.conch.showAssistantTouch(!0),y.enable("version.json",d.create(this,this.beginLoad),2)}s(t,"Main");var i=t.prototype;return i.beginLoad=function(){e.loader.load([{url:"res/atlas/game.atlas",type:"atlas"},{url:"CubeBoom.ani",type:"json"}],d.create(this,this.onLoaded))},i.onResize=function(){e.stage.canvasRotation||(M.instance.resize(),V.instance.centerX=0,V.instance.width=750,M.instance.tipDialogLayer.centerX=0,M.instance.tipDialogLayer.width=750)},i.onLoaded=function(){V.instance.replaceScene(new J),e.loader.load([{url:"sound/add.mp3",type:"sound"},{url:"sound/cubeboom.mp3",type:"sound"},{url:"sound/cubehit.mp3",type:"sound"}])},t}(),M=function(t){function i(){this.sceneLayer=null,this.menuLayer=null,this.windowLayer=null,this.tipsLayer=null,this.guideLayer=null,this.loadingProgress=null,this.tipDialogLayer=null,this.popupviewLayer=null,i.__super.call(this),this.sceneLayer=new u,this.menuLayer=new u,this.windowLayer=new u,this.tipsLayer=new u,this.guideLayer=new u,this.loadingProgress=new u,this.tipDialogLayer=new u,this.popupviewLayer=new u,this.sceneLayer.mouseThrough=!0,this.menuLayer.mouseThrough=!0,this.windowLayer.mouseThrough=!0,this.tipsLayer.mouseThrough=!0,this.guideLayer.mouseThrough=!0,this.loadingProgress.mouseThrough=!0,this.tipDialogLayer.mouseThrough=!0,this.popupviewLayer.mouseThrough=!0,this.full(this),this.full(this.sceneLayer),this.full(this.menuLayer),this.full(this.windowLayer),this.full(this.tipsLayer),this.full(this.guideLayer),this.full(this.loadingProgress),this.full(this.tipDialogLayer),this.full(this.popupviewLayer),this.addChild(this.sceneLayer),this.addChild(this.menuLayer),this.addChild(this.windowLayer),this.addChild(this.popupviewLayer),this.addChild(this.tipsLayer),this.addChild(this.guideLayer),this.addChild(this.loadingProgress),this.addChild(this.tipDialogLayer)}s(i,"com.bdoggame.mananger.LayerManager",t);var e=i.prototype;return e.resize=function(){this.full(this),this.full(this.sceneLayer),this.full(this.menuLayer),this.full(this.windowLayer),this.full(this.tipsLayer),this.full(this.guideLayer),this.full(this.loadingProgress),this.full(this.tipDialogLayer),this.full(this.popupviewLayer)},e.full=function(t){t.bottom=t.top=t.right=t.left=0},a(1,i,"instance",function(){return null==i._instance&&(i._instance=new i),i._instance},laya.ui.Component._$SET_instance),i._instance=null,i}(u),P=function(t){function i(t,e,n,s,a){if(this._alignWidth=0/0,this._clips=null,this._clipSkin=null,this._clipNum=0,this._registerString=null,this._baseRegister=null,this._registerMap=null,this._text=null,this._offset=0,this._offestMap=null,this._container=null,this._align="left",void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=10),i.__super.call(this),this._clipSkin=t,this._clipNum=n,this.mouseEnabled=!1,this._container=new u,this.addChild(this._container),this.text="",this._clips=[],this._baseRegister={},this._offset=e,this._registerMap=s?s:{},a){this._offestMap={};for(var o in a)this._offestMap[this.getIndex(o)]=a[o]}}s(i,"laya.customUI.JMornText",t);var n=i.prototype;return e.imps(n,{"com.bdoggame.interfaces.IText":!0}),n.changePos=function(){for(var t=0,i=0,e=0;e<this._clips.length;e++)i=this.getOffest(this._clips[e].index),this._clips[e].x=t+i/2,t+=this._clips[e].width+i;if(this._alignWidth)switch(this._align){case"center":this._container.x=(this._alignWidth-this._container.width)/2;break;case"right":this._container.x=this._alignWidth-this._container.width;break;default:this._container.x=0}},n.getOffest=function(t){return this._offestMap&&this._offestMap[t]?this._offestMap[t]:this._offset},n.update=function(){this.setClipNum(this._text.length);for(var t=0;t<this._text.length;t++)this._clips[t].index=this.getIndex(this._text.substr(t,1));if(this._offestMap)this.callLater(this.changePos);else if(this._alignWidth)switch(this._align){case"center":this._container.x=(this._alignWidth-this._container.width)/2;break;case"right":this._container.x=this._alignWidth-this._container.width;break;default:this._container.x=0}},n.setClipNum=function(t){for(var i=t-this._clips.length,e=0;e<this._clips.length;e++)this._container.addChild(this._clips[e]);if(0!=i)if(i>0){for(e=0;i>e;e++){var n=new h;n.skin=this._clipSkin,n.clipX=this._clipNum,this._clips.push(n),this._container.addChild(n)}this.callLater(this.changePos)}else for(var s=this._clips.length+i;s<this._clips.length;s++)this._clips[s].removeSelf()},n.skinChange=function(){for(var t=0;t<this._clips.length;t++)this._clips[t].skin=this._clipSkin,this._clips[t].clipX=this._clipNum;this.changePos()},n.getIndex=function(t){var i=this._baseRegister[t];return void 0!=this._registerMap[t]&&(i=this._registerMap[t]),i},n.dispose=function(){for(var t;this._clips.length;)t=this._clips.shift(),t.destroy()},a(0,n,"text",function(){return this._text},function(t){this._text!=t&&this._clipSkin&&(this._text=t,this.callLater(this.update))}),a(0,n,"align",function(){return this._align},function(t){this._align!=t&&(this._align=t,this.callLater(this.changePos))}),a(0,n,"clipSkin",function(){return this._clipSkin},function(t){this._clipSkin!=t&&(this._clipSkin=t,this.callLater(this.skinChange))}),a(0,n,"offset",function(){return this._offset},function(t){this._offset!=t&&(this._offset=t,this.callLater(this.changePos))}),a(0,n,"skin",function(){return this.clipSkin},function(t){this.clipSkin=t}),a(0,n,"incText",function(){return this.text},function(t){this.text=t}),a(0,n,"width",t.prototype._$get_width,function(t){e.superSet(u,this,"width",t),this._alignWidth=t}),a(0,n,"clipNum",function(){return this._clipNum},function(t){this._clipNum=t,this.callLater(this.skinChange)}),a(0,n,"registerString",function(){return this._registerString},function(t){if(this._registerString=t,null!=this._registerString&&""!=this._registerString){for(var i=0;i<this._registerString.length;i++)this._registerMap[this._registerString.charAt(i)+""]=i;this.callLater(this.update)}}),i.CENTER="center",i.LEFT="left",i.RIGHT="right",i}(u),A=function(t){function i(){this.currentHeadAngleVelocity=0,this.trailResolution=10,this.deathPosition=null,this.deathBlock=null,this.startBallCount=5,this.balls=[],this.mainBall=null,this.points=[],this.ySpeed=0,this.xSpeed=0,this._isSuperSnake=!1,this.colors=[new c([0,0,0,0,255,0,0,0,0,255,0,0,0,0,0,0,0,0,1,0]),new c([0,0,0,0,255,0,0,0,0,65,0,0,0,0,174,0,0,0,1,0]),new c([0,0,0,0,0,0,0,0,0,174,0,0,0,0,255,0,0,0,1,0])],this.colorIndex=0,this.colorTime=0,i.__super.call(this),this.spacing=36}s(i,"com.bdoggame.BallSnake",t);var n=i.prototype;return n.canHit=function(t){return this.mainBall==t},n.clearBalls=function(){var t;for(var i in this.balls)t=this.balls[i],t.removeSelf(),g.recover("Ball",t);this.balls.length=0},n.createBalls=function(t){for(var i=0;t>i;i++)this.createBall(this.balls.Count)},n.CreateBallStart=function(){this.clearBalls(),this.createBalls(this.startBallCount)},n.createBall=function(t){var i=g.getItemByClass("Ball",E);i.ballSnake=this,this.balls.push(i),this.parent.addChild(i),i.index=t,i.body.collisionMask=0,i.pos(this.x,this.y),i.body.velocity[0]=0,i.body.velocity[1]=0},n.sqrMagnitude=function(t,i){var e=t.x-i.x,n=t.y-i.y;return e*e+n*n},n.updateSnake=function(){if(this.isSuperSnake&&(this.colorTime-=e.timer.delta,this.colorTime<=0)){this.colorTime=100,this.colorIndex++,this.colorIndex>this.colors.length-1&&(this.colorIndex=0);var t;for(var i in this.balls)t=this.balls[i],t.img.filters=[this.colors[this.colorIndex]]}var t;for(var i in this.balls)t=this.balls[i],t.updateForPhysics();if(!(this.points.length<=0)){this.points[0]={x:this.mainBall.x,y:this.mainBall.y},1==this.points.length?this.points.push(this.points[0]):this.sqrMagnitude(this.points[0],this.points[1])>=this.trailResolution*this.trailResolution&&this.points.splice(1,0,this.points[0]);for(var n,s,t,a=1,o=this.spacing,r=o,l=0,h=m.TEMP,c={x:0,y:0};l<this.points.length-1&&a<this.balls.length;){n=this.points[l],s=this.points[l+1];var u=Math.sqrt(this.sqrMagnitude(s,n));if(u>0){h.x=s.x-n.x,h.y=s.y-n.y,h.normalize(),c.x=n.x,c.y=n.y;for(var p=this.balls.length;u>=r&&p>a;)c.x+=h.x*r,c.y+=h.y*r,t=this.balls[a],t.pos(c.x,c.y),u-=r,a++,r=o;r-=u}l++}for(var d=this.points[this.points.length-1],f=a;f<this.balls.length;f++)this.balls[a].pos(d.x,d.y);l++,l<this.points.length&&this.points.splice(l,this.points.length-l)}},n.LaunchSnake=function(t,i){this.points.length=0,this.CreateBallStart(),this.SetMainBall(),this.mainBall.pos(t,i),this.points.push({x:t,y:i}),this.points.push({x:t,y:i}),this.updateSnakeBallsValue(),this.currentHeadAngleVelocity=0},n.give=function(t){b.playSound("sound/add.mp3"),this.createBalls(t),this.updateSnakeBallsValue()},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.hit=function(t,i){if(!this.isSuperSnake){if(!this.canHit(t))return!1;this.updateSnake(),t.removeSelf();var e={};this.balls.length>0&&(e.x=this.balls[0].x,e.y=this.balls[0].y,this.balls.splice(0,1));var n=g.getItemByClass("BallBoom",o);if(n.loadAnimation("BallBoom.ani"),this.parent.addChild(n),n.pos(e.x,e.y),n.once("complete",this,function(){n.removeSelf(),g.recover("BallBoom",n)}),n.play(),this.balls.length<=0)this.deathPosition=e,this.deathBlock=i;else{var s={x:this.balls[0].x,y:this.balls[0].y},a=m.TEMP;a.x=e.x-s.x,a.y=e.y-s.y,a.normalize();for(var r=0,l=0;l<this.points.length&&!(this.Dot({x:s.x-this.points[l].x,y:s.y-this.points[l].y},a)>=0);l++)r=l;this.points.splice(0,r),s.x=e.x,this.mainBall.pos(s.x,s.y),this.points[0]=s,this.updateSnake(),this.SetMainBall(),this.updateSnakeBallsValue()}return!0}},n.SetMainBall=function(){this.mainBall=this.balls[0],this.mainBall.body.velocity[0]=this.xSpeed,this.mainBall.body.collisionMask=J.GROUP_BLOCK|J.GROUP_BALL_ITEM},n.updateSnakeBallsValue=function(){for(var t=0;t<this.balls.length;t++)this.balls[t].index=t},a(0,n,"ballCount",function(){return this.balls.length}),a(0,n,"isSuperSnake",function(){return this._isSuperSnake},function(t){this._isSuperSnake=t,t||this.updateSnakeBallsValue()}),i}(r),V=function(t){function i(){this._currentScene=null,this._sceneList=null,this._bg=null,this._img=null,i.__super.call(this),this._sceneList=[],this.bottom=this.top=0,this._img=new f,this._img.width=750,this._img.height=1334,this.addChild(this._img)}s(i,"com.bdoggame.mananger.SceneManager",t);var n=i.prototype;return n.replaceScene=function(t){this._sceneList.length=0,this._replaceScene(t)},n.pushScene=function(t){return this._currentScene!=t?(this._currentScene&&this._sceneList.push(this._currentScene),this._replaceScene(t)):void 0},n.popScene=function(){if(!(this._sceneList.length<=0)){var t=this._sceneList.pop();this._replaceScene(t)}},n.checkCurrentScene=function(t){return e.__typeof(this._currentScene,t)},n._replaceScene=function(t){p.manager.closeAll(),this._currentScene&&(e.__typeof(this._currentScene,"com.bdoggame.interfaces.IScene")&&this._currentScene.exit(),this.removeChild(this._currentScene)),t.top=t.bottom=0,this.addChild(t),this._currentScene=t,e.__typeof(t,"com.bdoggame.interfaces.IScene")&&t.enter()},n.showScene=function(t){this._currentScene&&(this._currentScene.visible=t),this._img.visible=!t},a(0,n,"currentScene",function(){return this._currentScene}),a(0,n,"bg",function(){return this._bg},function(t){this._bg!=t&&(this._bg=t,this._img.skin=this._bg)}),a(1,i,"instance",function(){return null==i._instance&&(i._instance=new i),i._instance},laya.ui.Box._$SET_instance),i._instance=null,i}(r),I=function(t){function i(t,e,n,s,a,o){this._minDigit=0,void 0===t&&(t=""),void 0===e&&(e=1),void 0===n&&(n=10),void 0===a&&(a=0),i.__super.call(this,t,a,n,s,o),this._baseRegister["0"]=0,this._baseRegister["1"]=1,this._baseRegister["2"]=2,this._baseRegister["3"]=3,this._baseRegister["4"]=4,this._baseRegister["5"]=5,this._baseRegister["6"]=6,this._baseRegister["7"]=7,this._baseRegister["8"]=8,this._baseRegister["9"]=9,this._minDigit=e>0?e:1,this.number=0}s(i,"laya.customUI.JMornNumber",t);var e=i.prototype;return a(0,e,"minDigit",function(){return this._minDigit},function(t){this._minDigit=t}),a(0,e,"number",function(){return Number(this.text)},function(t){for(var i=String(t);i.length<this._minDigit;)i="0"+i;this.text=i}),i}(P),H=function(t){function i(){this.autoUpdatePosition=!0,this.body=null,this.world=null,i.__super.call(this),this.p2=l.window.p2,this.world=laya.p2.LayaBody.world,this.on("display",this,this.onDisplay),this.on("undisplay",this,this.onUnDisPlay)}s(i,"laya.p2.LayaBody",t);var o=i.prototype;return o.onUnDisPlay=function(){this.world.removeBody(this.body),e.timer.clear(this,this.onDaleyAddBody),e.timer.clear(this,this.onFrame)},o.onDisplay=function(){this.world.addBody(this.body),this.setBodyPostion(),e.timer.frameLoop(1,this,this.onFrame),e.timer.frameOnce(1,this,this.onDaleyAddBody)},o.onDaleyAddBody=function(){this.displayedInStage&&(this.world.addBody(this.body),this.setBodyPostion())},o.onFrame=function(){this.autoUpdatePosition&&this.updateForPhysics()},o.updateForPhysics=function(){i.tempPos.x=this.body.position[0],i.tempPos.y=this.body.position[1],this.rotation=this.body.angle/Math.PI*180,e.superSet(v,this,"x",i.tempPos.x),e.superSet(v,this,"y",i.tempPos.y)},o.getPhysicsPos=function(t){return void 0===t&&(t=!1),t?new m(this.body.position[0],this.body.position[1]):(i.tempPos.x=this.body.position[0],i.tempPos.y=this.body.position[1],i.tempPos)},o.pos=function(t,i){return laya.display.Sprite.prototype.pos.call(this,t,i),this.setBodyPostion(),this},o.setPosition=function(t){this.pos(t.x,t.y)},o.setBodyPostion=function(){this.displayedInStage&&(this.body.position=this.p2.vec2.fromValues(this.x,this.y))},a(0,o,"bodyRotation",function(){return this.body.angle/Math.PI*180},function(t){this.body.angle=t/180*Math.PI}),a(0,o,"x",function(){return e.superGet(v,this,"x")},function(t){e.superSet(v,this,"x",t),this.setBodyPostion()}),a(0,o,"y",function(){return e.superGet(v,this,"y")},function(t){e.superSet(v,this,"y",t),this.setBodyPostion()}),i.world=null,n(i,["tempPos",function(){return this.tempPos=new m}]),i}(v),T=function(t){function i(){i.__super.call(this)}s(i,"laya.customUI.SceneView",t);var n=i.prototype;return e.imps(n,{"com.bdoggame.interfaces.IScene":!0}),n.enter=function(){},n.exit=function(){},i}(v),U=function(t){function i(){this.labelCount=null,i.__super.call(this)}s(i,"ui.BallSnakeUI",t);var e=i.prototype;return e.createChildren=function(){v.regComponent("JMornNumber",I),laya.ui.Component.prototype.createChildren.call(this),this.createView(i.uiView)},i.uiView={type:"View",props:{width:0,height:0},child:[{type:"JMornNumber",props:{y:-40,x:0,width:373,"var":"labelCount",text:0,skin:"game/Snake_Num_01.png",scaleY:.5,scaleX:.5,number:0,height:48,fontSize:40,font:"黑体",color:"#313131",clipNum:10,anchorY:.5,anchorX:.5,align:"center"}}]},i}(v),R=function(t){function i(){this.img=null,i.__super.call(this)}s(i,"ui.BallUI",t);var e=i.prototype;return e.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this),this.createView(i.uiView)},i.uiView={type:"LayaBody",props:{width:20,height:20},child:[{type:"Image",props:{y:0,x:0,"var":"img",skin:"game/Snake_Ball.png",anchorY:.5,anchorX:.5}}]},i}(H),D=function(t){function i(){this.img=null,this.labelNum=null,i.__super.call(this)}s(i,"ui.BallItemUI",t);var e=i.prototype;return e.createChildren=function(){v.regComponent("JMornNumber",I),laya.ui.Component.prototype.createChildren.call(this),this.createView(i.uiView)},i.uiView={type:"LayaBody",props:{},child:[{type:"Image",props:{y:0,x:0,"var":"img",skin:"game/Snake_Ball.png",anchorY:.5,anchorX:.5}},{type:"JMornNumber",props:{y:-40,x:0,width:373,"var":"labelNum",text:0,skin:"game/Snake_Num_01.png",scaleY:.5,scaleX:.5,number:0,height:48,fontSize:40,font:"黑体",color:"#313131",clipNum:10,anchorY:.5,anchorX:.5,align:"center"}}]},i}(H),N=function(t){function i(){this.img=null,i.__super.call(this)}s(i,"ui.BarUI",t);var e=i.prototype;return e.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this),this.createView(i.uiView)},i.uiView={type:"LayaBody",props:{width:8,height:0},child:[{type:"Image",props:{y:0,x:0,"var":"img",skin:"game/Snake_Wall.png",anchorY:.5,anchorX:.5,sizeGrid:"8,3,12,2"}}]},i}(H),O=function(t){function i(){this.img=null,this.hpLabel=null,i.__super.call(this)}s(i,"ui.BlockUI",t);var e=i.prototype;return e.createChildren=function(){v.regComponent("JMornNumber",I),laya.ui.Component.prototype.createChildren.call(this),this.createView(i.uiView)},i.uiView={type:"LayaBody",props:{width:90,height:90},child:[{type:"Image",props:{y:0,x:0,"var":"img",skin:"game/Snake_Cube_Spec.png",anchorY:.5,anchorX:.5}},{type:"JMornNumber",props:{y:42,x:-1,width:130,"var":"hpLabel",text:0,skin:"game/Snake_Num_02.png",offset:0,number:12,height:47,fontSize:40,font:"黑体",color:"#313131",clipNum:10,anchorY:.5,anchorX:.5,align:"center"}}]},i}(H),G=function(t){function i(){this.labelScore=null,i.__super.call(this)}s(i,"ui.GameViewUI",t);var e=i.prototype;return e.createChildren=function(){v.regComponent("JMornNumber",I),laya.ui.Component.prototype.createChildren.call(this),this.createView(i.uiView)},i.uiView={type:"SceneView",props:{width:750,height:1334},child:[{type:"JMornNumber",props:{y:86,x:360,width:373,"var":"labelScore",text:0,skin:"game/Snake_Num_01.png",number:0,height:48,fontSize:40,font:"黑体",color:"#313131",clipNum:10,align:"right"}}]},i}(T),E=function(t){function i(){this._index=0,this.ballSnake=null,this.filter=null,i.__super.call(this),this.autoUpdatePosition=!1,this.body=new this.p2.Body({mass:1,position:[0,0],damping:0});var t=new this.p2.Circle({radius:18});this.body.addShape(t,[0,0],0),t.collisionGroup=J.GROUP_BALL,t.collisionMask=J.GROUP_BLOCK|J.GROUP_BALL_ITEM,t.material=J.ballMat,this.body.sprite=this,this.body.label="ball",this.filter=new c([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),this.img.filters=[this.filter]}s(i,"com.bdoggame.Ball",t);var e=i.prototype;return e.hit=function(t){b.playSound("sound/cubehit.mp3"),this.body.velocity[0]=0,this.body.velocity[1]=0,this.body.setZeroForce(),this.ballSnake.hit(this,t)},e.onUnDisPlay=function(){laya.p2.LayaBody.prototype.onUnDisPlay.call(this),g.recover("Ball",this)},a(0,e,"canHit",function(){return this.ballSnake.canHit(this)}),a(0,e,"index",function(){return this._index},function(t){this._index=t,this.ballSnake.ballCount>1&&!this.ballSnake.isSuperSnake&&(this.filter=new c([1,0,0,0,this.index/(this.ballSnake.ballCount-1)*-60,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),this.img.filters=[this.filter])}),i}(R),X=function(t){function i(){this.value=0,i.__super.call(this),this.body=new this.p2.Body({mass:0,position:[0,0],damping:0,ccdSpeedThreshold:0});var t=new this.p2.Circle({radius:18});t.sensor=!0,this.body.addShape(t,[0,0],0),t.collisionGroup=J.GROUP_BALL_ITEM,t.collisionMask=J.GROUP_BALL,t.material=J.ballMat,this.body.sprite=this,this.body.label="ballItem"}s(i,"com.bdoggame.BallItem",t);var e=i.prototype;return e.onUnDisPlay=function(){laya.p2.LayaBody.prototype.onUnDisPlay.call(this),g.recover("ballItem",this)},a(0,e,"Value",function(){return this.value},function(t){this.value=t,this.labelNum.text=t+""}),i}(D),F=function(t){function i(){this.shape=null,i.__super.call(this),this.body=new this.p2.Body({mass:1,type:this.p2.Body.KINEMATIC,ccdSpeedThreshold:0}),this.shape=new this.p2.Box({width:this.img.width,height:this.img.height}),this.shape.collisionGroup=J.GROUP_BLOCK,this.shape.collisionMask=J.GROUP_BALL,this.shape.material=J.blockMat,this.body.addShape(this.shape)}s(i,"com.bdoggame.Bar",t);var e=i.prototype;return e.setBoxHeight=function(t){this.height=t,this.img.height=t,this.shape.height!=t&&(this.body.removeShape(this.shape),this.shape=new this.p2.Box({width:this.img.width,height:t}),this.shape.collisionGroup=J.GROUP_BLOCK,this.shape.collisionMask=J.GROUP_BALL,this.shape.material=J.blockMat,this.body.addShape(this.shape))},i}(N),z=function(t){function i(){this._isSuperBlock=!1,this.value=0,this.tween=null,i.__super.call(this),this.body=new this.p2.Body({mass:0});var t=new this.p2.Box({width:this.img.width,height:this.img.height});t.collisionGroup=J.GROUP_BLOCK,t.collisionMask=J.GROUP_BALL,t.material=J.blockMat,this.body.addShape(t),this.body.sprite=this,this.body.label="block"}s(i,"com.bdoggame.Block",t);var e=i.prototype;return e.onDisplay=function(){laya.p2.LayaBody.prototype.onDisplay.call(this),this.img.scale(1,1)},e.onUnDisPlay=function(){laya.p2.LayaBody.prototype.onUnDisPlay.call(this),g.recover("Block",this)},e.hit=function(t){if(this.displayedInStage)if(J.current.ballHitBlock(this),t.ballSnake.isSuperSnake?(J.current.score+=this.Value,this.Value=0):(J.current.score++,this.Value--),this.Value<=0){b.playSound("sound/cubeboom.mp3");var i=g.getItemByClass("BoomAni",o);i.loadAnimation("CubeBoom.ani"),this.parent.addChild(i),i.pos(this.x,this.y),i.once("complete",this,function(){i.removeSelf(),g.recover("BoomAni",i)}),i.play(),this.removeSelf(),this.isSuperBlock&&J.current.setSuperBall()}else this.img.scale(.95,.95),this.tween&&this.tween.complete(),this.tween=_.to(this.img,{scaleX:1,scaleY:1},100)},a(0,e,"Value",function(){return this.value},function(t){this.value=t,this.hpLabel.text=t+"",this.isSuperBlock=this._isSuperBlock}),a(0,e,"isSuperBlock",function(){return this._isSuperBlock},function(t){if(this._isSuperBlock=t,t)this.img.skin="game/Snake_Cube_Spec.png",this.hpLabel.y=42,this.hpLabel.scale(.9,.9);else{var i=6-Math.ceil(50/this.Value);i=Math.min(5,Math.max(1,i)),this.img.skin="game/Snake_Cube_0"+i+".png",this.hpLabel.y=2,this.hpLabel.scale(1,1)}}),i}(O),J=function(t){function i(){function t(t){var i,n;if("ball"==t.bodyA.label?(i=t.bodyB,n=t.bodyA.sprite):(i=t.bodyA,n=t.bodyB.sprite),"block"==i.label){var s=t.contactEquations[0].normalA;if(s[1]>=0||Math.abs(s[0])>=Math.abs(s[1]))return;var a=i.sprite;n.canHit&&e.canHit&&(a.hit(n),n.hit(a),e.ballsnake.ballCount<=0&&e.gameOver())}else if("ballItem"==i.label){var o=i.sprite;e.ballsnake.give(o.Value),o.removeSelf()}}this.horizontalSpeedMax=3e3,this.verticalSpeedAccelerationStepValue=50,this.verticalSpeedAccelerationStepCount=10,this.verticalSpeedMax=1e3,this.verticalSpeed=320,this.currentHitBlock=null,this.world=null,this._score=0,this.ballsnake=null,this.itemList=null,this.container=null,this.currentX=0/0,this.downBallX=0/0,this.currentLine=0,this.currentIntervalHeight=0,this.BeforeNextBlockLine=0/0,this.nextblockArea=0/0,this.nextblockAreaLineCount=0/0,this.secondPhase=!1,this.column=5,this.snakeView=null,this.NextHorizontal=0/0,this.maxSpeedRectification=!0,this.isHitting=!1,this.maxBlockValue=50,this.minBlockValue=1,this.blockLineCountMax=2,this.blockLineCountMin=1,this.barProbability=.2,this.areaMin=4,this.areaMax=7,this.minBallValue=1,this.intervalBallProbability=.1,this.maxBallValue=5,this.firstAreaValueFactor=.25,this.blockValueFactor=.5,this.startBallCount=3,this.intervalHeightMax=3,this.intervalHeightMin=1,this.startingPhaseBallCoordinates=[],this.superBlockValue=25,this.superBlockLine=3,this.superStartTime=0/0,this.currentBlockLine=0,this.currentVerticalSmoothVelocity=0/0,this.currentHorizontalSmoothVelocity=0,this.currentMinSpeedForHit=0,this.currentBlockHitCount=0,this.remainingTimeBeforeCanHitAgain=0,this.speedLine=5,this.valueArea1=[[1,5],[6,15],[16,30]],this.valueArea2=[[10,20],[21,30],[31,50]],this.valueArea3=[[1,10],[11,25],[26,50]],this.valueArea2Probability=.2,i.__super.call(this),this.JP2Render=l.window.JP2Render,this.p2=l.window.p2;var e=this;this.itemList=[],i.current=this,this.world=new this.p2.World({gravity:[0,0]}),this.container=this.container||new r,this.addChild(this.container),H.world=this.world;var n=x.getRequestParameter();this.speedLine=null!=n.line?parseInt(n.line):7,i.ballMat=new this.p2.Material,i.blockMat=new this.p2.Material,this.world.addContactMaterial(new this.p2.ContactMaterial(i.ballMat,i.blockMat,{friction:0,stiffness:Number.MAX_VALUE})),this.world.on("beginContact",t),this.world.on("preSolve",function(t){if(!(t.contactEquations.length<=0)){var i;for(var n in t.contactEquations){i=t.contactEquations[n];var s,a;if("ball"==i.bodyA.label?(s=i.bodyB,a=i.bodyA.sprite):(s=i.bodyA,a=i.bodyB.sprite),"block"==s.label){var o=i.normalA;if(o[1]>=0||Math.abs(o[0])>=Math.abs(o[1]))continue;var r=s.sprite;a.canHit&&e.canHit&&(r.hit(a),a.hit(r),e.ballsnake.ballCount<=0&&e.gameOver())}}}}),this.on("display",this,this.onAdd),this.on("mousedown",this,this.onDown)}s(i,"com.bdoggame.GameView",t);var o=i.prototype;return o.onAdd=function(){this.gamestart()},o.onDown=function(){this.currentVerticalSmoothVelocity=0,this.currentX=this.mouseX,this.downBallX=this.ballsnake.mainBall.x,this.NextHorizontal=this.downBallX,this.isDown=!0,this.stage.on("mouseup",this,this.onUp)},o.onUp=function(){this.stage.off("mouseup",this,this.onUp),this.isDown=!1,this.p2.vec2.set(this.ballsnake.mainBall.body.velocity,0,this.getVerticalSpeed())},o.onMove=function(){var t=this.ballsnake.mainBall.body.velocity;if(t[1]>0&&(t[1]=0),this.isDown){var i=this.ballsnake.mainBall.x;if(this.maxSpeedRectification){var n=i-this.NextHorizontal;this.downBallX+=n}var s=this.downBallX+1.2*(this.mouseX-this.currentX),a=Math.abs(s),o=this.width-18;if(s>o){var r=(o-a)*L.Sign(s);s+=r,this.downBallX+=r}else if(18>s){var r=18-s;s+=r,this.downBallX+=r}var l=L.SD(i,s,this.currentHorizontalSmoothVelocity,.05,e.timer.delta/1e3),h=l[0];this.currentHorizontalSmoothVelocity=l[1],this.NextHorizontal=h,t[0]=(h-i)/(e.timer.delta/1e3),t[0]=L.Clamp(t[0],-this.horizontalSpeedMax,this.horizontalSpeedMax)}else t[0]=0;var c=(t[1],this.getVerticalSpeed());t[1]=c,this.ballsnake.ySpeed=t[1],this.ballsnake.xSpeed=t[0]},o.gamestart=function(){this.score=0,this.container.y=0,this.currentBlockLine=0;for(var t=this.container.numChildren-1;t>=0;t--)this.container.removeChildAt(t);this.itemList.length=0,this.ballsnake=this.ballsnake||new A,this.container.addChild(this.ballsnake),this.ballsnake.x=this.width/2,this.ballsnake.y=this.height-400,this.snakeView=this.snakeView||new U,this.addChild(this.snakeView),this.superBlockValue=25,this.superBlockLine=3,this.ballsnake.LaunchSnake(this.ballsnake.x,this.ballsnake.y),this.snakeView.pos(this.ballsnake.x,this.ballsnake.y),this.p2.vec2.set(this.ballsnake.mainBall.body.velocity,0,this.getVerticalSpeed()),this.mouseEnabled=!0,this.currentLine=0,this.nextblockArea=0,this.nextblockAreaLineCount=0,this.currentIntervalHeight=5,this.BeforeNextBlockLine=this.currentIntervalHeight+1;for(var i=this.startBallCount,n=5,s=[],t=0;n>t;t++)for(var a=0;a<this.column;a++)s.push(new S(a,t));this.startingPhaseBallCoordinates.length=0;for(var o=0;i>o;o++){var r=w.rangeInt(0,s.length);this.startingPhaseBallCoordinates.push(s[r]),s.splice(r,1)
}this.startingPhase=!0,this.secondPhase=!1,e.timer.frameLoop(1,this,this.onFrame)},o.gameOver=function(){e.timer.clear(this,this.onFrame),e.timer.once(2e3,this,this.revive)},o.revive=function(){this.gamestart()},o.onFrame=function(){this.superStartTime>0&&(this.superStartTime-=e.timer.delta,this.superStartTime<=0&&(this.ballsnake.isSuperSnake=!1)),this.onMove(),this.update(),m.TEMP.x=0,m.TEMP.y=0,this.ballsnake.mainBall.localToGlobal(m.TEMP),this.container.y+=Math.max(this.height/2-m.TEMP.y,0),this.world.step(1/240),this.world.step(1/240),this.world.step(1/240),this.world.step(1/240),this.ballsnake.updateSnake(),this.snakeView.pos(this.ballsnake.mainBall.x,this.ballsnake.mainBall.y+this.container.y),this.snakeView.labelCount.text=this.ballsnake.ballCount+"",this.isHitting?(this.wasHittingLastFrame=!0,this.remainingTimeBeforeCanHitAgain-=e.timer.delta/1e3,this.remainingTimeBeforeCanHitAgain<=0&&(this.remainingTimeBeforeCanHitAgain=0,this.isHitting=!1)):this.wasHittingLastFrame=!1;for(var t,i=this.itemList.length-1;i>=0;i--)t=this.itemList[i],t.y+t.height+this.container.y>this.height+400&&(t.removeSelf(),this.itemList.splice(i,1))},o.update=function(){for(var t=-this.container.y-this.height,i=(150*(this.column-1),75);;){var e=150*-this.currentLine;if(t>e)break;var n=e+75,s=!1,a=!1,o=!1;this.BeforeNextBlockLine--,this.BeforeNextBlockLine<=0&&(s=!0,this.currentIntervalHeight=2,this.BeforeNextBlockLine=3,this.nextblockArea--,this.nextblockArea<=0&&(a=!0,this.currentBlockLine++,this.superBlockLine--,this.superBlockLine<=0&&(this.ballsnake.isSuperSnake||(o=!0),this.superBlockLine=2),this.nextblockAreaLineCount=w.rangeInt(this.areaMin,this.areaMax+1),this.nextblockArea=this.nextblockAreaLineCount+1));var r=this.valueArea1;this.currentBlockLine>=5&&Math.random()<this.valueArea2Probability?r=this.valueArea2:a&&(r=this.valueArea3);var l=[];if(s&&!a){for(var h=0,c=[],u=0;u<this.column;u++)c.push(u);for(var p=0;p<this.column;p++)if(!(Math.random()>this.barProbability)){if(h>2)break;h++;var d=w.rangeInt(0,c.length),f=c[d];if(l.push(f),c.splice(d,1),w.spleceToList(c,f-1),w.spleceToList(c,f+1),c.Count<=0)break}}var y=!1,b=-1,_=-1;if(a){if(b=w.rangeInt(0,this.column),o)for(_=w.rangeInt(0,this.column);_==b;)_=w.rangeInt(0,this.column)}else!s||1!=this.nextblockArea&&this.nextblockAreaLineCount-this.nextblockArea!=0||(y=!0);for(var v=m.TEMP,B=0,S=0,k=0,x=[],c=[],u=0;u<this.column;u++)c.push(u);for(var p=0;p<this.column;p++){var d=w.rangeInt(0,c.length),f=c[d];if(1>S||2>S&&Math.random()<.2?(S++,x[f]=0):1>k|(2>k&&Math.random()<.2)?(k++,x[f]=1):x[f]=2,c.splice(d,1),c.Count<=0)break}for(var L=0;L<this.column;L++){v.x=i+150*L,v.y=n;var C=!1,M=!1;if(a?C=!0:this.startingPhase?this.checkCoordinates(L,this.currentLine)&&(M=!0):this.secondPhase||(s?-1!=l.indexOf(L)?C=!0:Math.random()<=this.intervalBallProbability&&(M=!0):Math.random()<=this.intervalBallProbability&&(M=!0)),C){var P=this.minBlockValue,A=this.maxBlockValue;if(P=r[x[L]][0],A=r[x[L]][1],this.startingPhase&&(P=1,A=2),!a){var V=Math.random();P=r[x[.4>V?0:.8>V?1:2]][0],A=r[x[.4>V?0:.8>V?1:2]][1]}if(A>0){var I=g.getItemByClass("Block",z);I.Value=w.rangeInt(P,A+1),I.pos(v.x,v.y),this.container.addChild(I),this.itemList.push(I),o&&_==L?(I.isSuperBlock=!0,I.Value=this.superBlockValue):I.isSuperBlock=!1}}if(M&&!this.secondPhase&&3>B){B++;var H=g.getItemByClass("BallItem",X);H.Value=w.rangeInt(this.minBallValue,this.maxBallValue+1),H.pos(v.x,v.y),this.container.addChild(H),this.itemList.push(H)}if(s&&!this.startingPhase&&!this.secondPhase&&L<this.column-1&&-1!=l.indexOf(L)){var T=g.getItemByClass("Bar",F);T.setBoxHeight(150*this.currentIntervalHeight),T.pos(v.x+.5*(150+T.img.width),v.y+.5*(150+T.img.height)),this.container.addChild(T),this.itemList.push(T)}}this.startingPhase?a&&(this.startingPhase=!1,this.secondPhase=!0,this.currentIntervalHeight=2,this.BeforeNextBlockLine=this.currentIntervalHeight+1):this.secondPhase&&s&&(this.secondPhase=!1),this.currentLine++}},o.checkCoordinates=function(t,i){var e;for(var n in this.startingPhaseBallCoordinates)if(e=this.startingPhaseBallCoordinates[n],e.x==t&&e.y==i)return!0;return!1},o.getVerticalSpeed=function(){if(this.ballsnake.isSuperSnake)return-this.verticalSpeedMax;var t=Math.min(Math.floor(this.currentBlockLine/this.speedLine)/8*this.verticalSpeedMax+this.verticalSpeed,this.verticalSpeedMax),i=this.ballsnake.mainBall;if(!this.wasHittingLastFrame||this.currentDelayBetweenHits<=0||null==i||null==this.currentHitBlock)return-t;var e=this.currentHitBlock.y-(i.y+18);return 0>e&&(this.currentMinSpeedForHit=e/-this.currentDelayBetweenHits),-Math.max(this.currentMinSpeedForHit,t)},o.setSuperBall=function(){this.superBlockValue=Math.min(50,this.superBlockValue+5),this.ballsnake.isSuperSnake=!0,this.superStartTime=1e4},o.ballHitBlock=function(t){this.isHitting=!0,this.currentHitBlock!=t&&(null!=this.currentHitBlock&&this.currentHitBlock.off("undisplay",this,this.onBlockUnDisplay),this.currentHitBlock=t,null!=this.currentHitBlock&&this.currentHitBlock.once("undisplay",this,this.onBlockUnDisplay),this.currentBlockHitCount=0),this.currentBlockHitCount++,this.currentDelayBetweenHits=Math.min(1,Math.max(.5,this.currentBlockHitCount/10)),this.remainingTimeBeforeCanHitAgain=.1*(1.1-this.currentDelayBetweenHits)},o.onBlockUnDisplay=function(){this.currentHitBlock=null},a(0,o,"score",function(){return this._score},function(t){this._score=t,this.labelScore.text=this._score+""}),a(0,o,"canHit",function(){return!this.isHitting}),i.current=null,i.ballMat=null,i.blockMat=null,i.BALL_SIZE=18,i.BLOCK_SIZE=150,n(i,["GROUP_BLOCK",function(){return this.GROUP_BLOCK=Math.pow(2,0)},"GROUP_BALL",function(){return this.GROUP_BALL=Math.pow(2,1)},"GROUP_BALL_ITEM",function(){return this.GROUP_BALL_ITEM=Math.pow(2,2)}]),i}(G);new C}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});for(var e in Laya){var n=Laya[e];n&&n.__isclass&&(i[e]=n)}});